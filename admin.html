<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - QnA Kampung KB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            color: #333;
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .admin-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Questions Section */
        .questions-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1e3c72;
        }

        .refresh-btn {
            background: #28a745;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        /* Question Items */
        .question-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .question-item {
            padding: 1.5rem;
            border-bottom: 1px solid #f1f3f4;
            transition: background 0.3s;
        }

        .question-item:hover {
            background: #f8f9fa;
        }

        .question-item.answered {
            background: #f8fff8;
            border-left: 4px solid #28a745;
        }

        .question-item.pending {
            background: #fff8f0;
            border-left: 4px solid #ffc107;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .question-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .author-name {
            font-weight: bold;
            color: #1e3c72;
        }

        .question-time {
            background: #e9ecef;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #666;
        }

        .question-category {
            background: #007bff;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .question-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-answered {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .question-text {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-style: italic;
        }

        /* Answer Section */
        .answer-section {
            margin-top: 1rem;
        }

        .current-answer {
            background: #d4edda;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
        }

        .answer-label {
            font-weight: bold;
            color: #155724;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .answer-form {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }

        .answer-textarea {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .answer-textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        .submit-answer-btn {
            background: #1e3c72;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .submit-answer-btn:hover {
            background: #2a5298;
            transform: translateY(-1px);
        }

        .submit-answer-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .loading::after {
            content: "...";
            animation: dots 2s infinite;
        }

        @keyframes dots {
            0% { content: ""; }
            25% { content: "."; }
            50% { content: ".."; }
            75% { content: "..."; }
            100% { content: ""; }
        }

        /* Success Message */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
            display: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            color: #333;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .container {
                padding: 0 1rem;
            }

            .question-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .question-meta {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .answer-form {
                flex-direction: column;
            }

            .submit-answer-btn {
                width: 100%;
            }
        }

        /* Custom Scrollbar */
        .question-list::-webkit-scrollbar {
            width: 8px;
        }

        .question-list::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .question-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .question-list::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div>
                <h1>üéØ Admin Dashboard</h1>
                <p>Kelola Pertanyaan QnA Kampung KB</p>
            </div>
            <div class="admin-badge">
                üë®‚Äçüíº Admin Mode
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalQuestions">-</div>
                <div class="stat-label">Total Pertanyaan</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingQuestions">-</div>
                <div class="stat-label">Menunggu Jawaban</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="answeredQuestions">-</div>
                <div class="stat-label">Sudah Dijawab</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="todayQuestions">-</div>
                <div class="stat-label">Pertanyaan Hari Ini</div>
            </div>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            ‚úÖ Jawaban berhasil disimpan!
        </div>

        <!-- Questions Section -->
        <div class="questions-section">
            <div class="section-header">
                <h2 class="section-title">üìã Daftar Pertanyaan</h2>
                <button class="refresh-btn" onclick="loadQuestions()">
                    üîÑ Refresh Data
                </button>
            </div>
            
            <div class="question-list" id="questionsList">
                <div class="loading" id="loadingMessage">
                    Memuat data dari Google Sheets
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const SHEET_ID = '14gRlgi-XiDMPiaU-cga2FZE_n09NYIIFcTQo3xOskBU';
        
        // Sample data for demonstration
        let questionsData = [
            {
                id: 1,
                timestamp: '2025/01/10 14:30:00',
                name: 'Ibu Sari Wulandari',
                email: 'sari@email.com',
                category: 'Program KB',
                question: 'Bagaimana cara mendaftarkan diri untuk mengikuti program KB di Kampung KB? Apakah ada syarat khusus yang harus dipenuhi?',
                answer: '',
                status: 'pending'
            },
            {
                id: 2,
                timestamp: '2025/01/10 10:15:00',
                name: 'Bapak Ahmad Rizki',
                email: 'ahmad@email.com',
                category: 'Kegiatan Kampung KB',
                question: 'Apa saja kegiatan rutin yang dilakukan di Kampung KB? Apakah ada jadwal yang bisa saya ikuti?',
                answer: 'Kegiatan rutin meliputi: posyandu bulanan setiap tanggal 5, kelas ibu hamil setiap Rabu pagi, penyuluhan KB setiap Jumat sore, senam sehat keluarga setiap Minggu pagi di lapangan RT, dan konseling pranikah setiap Selasa. Jadwal lengkap bisa dilihat di papan pengumuman RT/RW atau hubungi kader KB setempat.',
                status: 'answered'
            },
            {
                id: 3,
                timestamp: '2025/01/10 08:45:00',
                name: 'Ibu Maya Sinta',
                email: 'maya@email.com',
                category: 'Layanan Kesehatan',
                question: 'Apakah layanan konseling KB di Kampung KB gratis? Dan bagaimana prosedur untuk mendapatkan layanan tersebut?',
                answer: 'Ya, semua layanan konseling KB di Kampung KB 100% gratis. Prosedurnya sangat mudah: 1) Datang ke pos KB terdekat dengan membawa KTP dan KK, 2) Isi formulir konseling, 3) Konsultasi dengan petugas KB yang tersertifikasi, 4) Dapatkan alat kontrasepsi gratis jika diperlukan. Buka setiap hari Senin-Jumat jam 08.00-15.00.',
                status: 'answered'
            }
        ];

        // Category colors
        const categoryColors = {
            'umum': '#6c757d',
            'program kb': '#007bff',
            'kegiatan kampung kb': '#28a745', 
            'layanan kesehatan': '#17a2b8',
            'administrasi': '#fd7e14'
        };

        // Format timestamp
        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);

            if (diffHours < 1) return 'Baru saja';
            if (diffHours < 24) return `${diffHours} jam yang lalu`;
            if (diffDays < 7) return `${diffDays} hari yang lalu`;
            return date.toLocaleDateString('id-ID');
        }

        // Update statistics
        function updateStats(data) {
            const total = data.length;
            const pending = data.filter(q => q.status === 'pending').length;
            const answered = data.filter(q => q.status === 'answered').length;
            
            // Get today's questions
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const todayCount = data.filter(q => {
                const qDate = new Date(q.timestamp).toISOString().split('T')[0];
                return qDate === todayStr;
            }).length;

            document.getElementById('totalQuestions').textContent = total;
            document.getElementById('pendingQuestions').textContent = pending;
            document.getElementById('answeredQuestions').textContent = answered;
            document.getElementById('todayQuestions').textContent = todayCount;
        }

        // Display questions
        function displayQuestions(data) {
            const container = document.getElementById('questionsList');
            const loading = document.getElementById('loadingMessage');

            if (data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üìù Belum Ada Pertanyaan</h3>
                        <p>Pertanyaan dari pengguna akan muncul di sini</p>
                    </div>
                `;
                return;
            }

            // Sort by timestamp (newest first)
            const sortedData = data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            const questionsHTML = sortedData.map(q => {
                const categoryKey = q.category.toLowerCase();
                const categoryColor = categoryColors[categoryKey] || categoryColors.umum;
                
                return `
                    <div class="question-item ${q.status}" data-id="${q.id}">
                        <div class="question-header">
                            <div class="question-meta">
                                <span class="author-name">üë§ ${q.name}</span>
                                <span class="question-time">üïí ${formatTime(q.timestamp)}</span>
                                <span class="question-category" style="background: ${categoryColor}">
                                    üìÇ ${q.category}
                                </span>
                            </div>
                            <span class="question-status ${q.status === 'answered' ? 'status-answered' : 'status-pending'}">
                                ${q.status === 'answered' ? '‚úÖ Sudah Dijawab' : '‚è≥ Menunggu Jawaban'}
                            </span>
                        </div>
                        
                        <div class="question-text">
                            üí¨ "${q.question}"
                        </div>

                        <div class="answer-section">
                            ${q.answer ? `
                                <div class="current-answer">
                                    <div class="answer-label">üí° Jawaban Anda:</div>
                                    <div>${q.answer}</div>
                                </div>
                            ` : ''}
                            
                            <div class="answer-form">
                                <textarea 
                                    class="answer-textarea" 
                                    placeholder="Ketik jawaban untuk pertanyaan ini..."
                                    data-question-id="${q.id}"
                                >${q.answer || ''}</textarea>
                                <button 
                                    class="submit-answer-btn" 
                                    onclick="submitAnswer(${q.id})"
                                    ${q.status === 'answered' ? '' : ''}
                                >
                                    ${q.answer ? '‚úèÔ∏è Update Jawaban' : 'üì§ Kirim Jawaban'}
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = questionsHTML;
            loading.style.display = 'none';
        }

        // Submit answer
        async function submitAnswer(questionId) {
  const q = questionsData.find(x => x.id === questionId);
  const textarea = document.querySelector(`[data-question-id="${questionId}"]`);
  const answer = (textarea?.value || '').trim();
  if (!answer) return alert('Silakan masukkan jawaban terlebih dahulu');

  const res = await fetch(SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ rowNumber: q.rowNumber, answer })
  });
  const result = await res.json();
  if (!result.ok) throw new Error(result.error || 'Gagal menyimpan');

  await loadQuestions();
  const successMsg = document.getElementById('successMessage');
  successMsg.style.display = 'block';
  setTimeout(() => successMsg.style.display = 'none', 3000);
}


        // Load questions from Google Sheets
        async function loadQuestions() {
  const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(SHEET_NAME)}?key=${API_KEY}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const data = await res.json();

  const rows = (data.values || []).slice(1); // skip header
  questionsData = rows.map((row, i) => ({
    id: i + 1,
    rowNumber: i + 2,
    timestamp: row[0] || '',
    name: row[1] || 'Penanya Anonim',
    question: row[2] || '',
    category: row[3] || 'Umum',
    answer: row[4] || '',
    status: row[4] ? 'answered' : 'pending'
  }));

  displayQuestions(questionsData);
  updateStats(questionsData);
}


        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadQuestions();
            
            // Auto-refresh every 60 seconds
            setInterval(loadQuestions, 60000);
        });

        // Add some interactive features
        document.addEventListener('keydown', function(e) {
            // Ctrl+R to refresh
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                loadQuestions();
            }
        });
    </script>
</body>
</html>
